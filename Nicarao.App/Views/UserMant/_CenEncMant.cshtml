@model  PJN.DAL.Model.GENERAL.catCensoEncuesta

<div class="container">
    <div class="card">
        <div class="card-body">
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Id">
                            @Html.TextBoxFor(model => model.Id, new { id = "txtCenEncId", PlaceHolder = "Id", @class = "form-control", autocomplete = "off", disabled = "disabled" })
                            <span>Id</span>
                        </label>
                        @Html.ValidationMessage("id", "* Campo Requerido *", new { id = "lblcenencid", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Descripcion">
                            @Html.TextBoxFor(model => model.Descripcion, new { id = "txtCenEncDescripcion", PlaceHolder = "Descripcion", @class = "form-control" })
                            <span>Descripción</span>
                        </label>
                        @Html.ValidationMessage("descripcion", "* Campo Requerido *", new { id = "lblcenencdescripcionr", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div> 
            <div class="row justify-content-center" id="ActivoCenEnc">
                <label class="input-control checkbox small-check">
                    <input type="checkbox" id="activocenenc" value="true" checked>
                    <span class="check"></span>
                    <span class="caption">Activo</span>
                </label>
                <label class="input-control checkbox small-check">
                    <input type="checkbox" id="inactivocenenc" value="false">
                    <span class="check"></span>
                    <span class="caption">Inactivo</span>
                </label>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="row" style=" height: 100px; align-content: center;">
                        <div class="col-md-12 d-flex justify-content-center" id="rowButtons">
                            <button class="btn btn-primary" style="margin-right:10px;" data-tabcontinuar="data-tabcontinuar" id="btnGuardaCenEnc" onclick="AgregarCenEnc()">
                                <span>Guardar</span>
                                <span class="fa fa-database"></span>
                            </button>
                            <button class="btn btn-secondary" style="margin-right:10px; display:none" data-tabcontinuar="data-tabcontinuar" id="btnActualizarCenEnc" onclick="ActualizarCenEnc('Actualiza')">
                                <span>Actualizar</span>
                                <span class="fa fa-database"></span>
                            </button>
                            <button class="btn btn-success" style="margin-right:10px;" data-tabcontinuar="data-tabcontinuar" id="btnNuevoCenEnc" onclick="NuevaCenEnc()">
                                <span>Nuevo</span>
                                <span class="fa fa-plus"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
@<script type="text/javascript">
                function ActualizarCenEnc() {
                    var bandera = true;
                    
                    if ($('#txtCenEncDescripcion').val().toString().length < 1) {
                        $("#lblcenencdescripcionr").show();
                        bandera = false;
                    }
                    if (bandera == true) {
                        showalertify();
                        $("#lblcenencdescripcionr").hide();

                        var listaCheck = $("#ActivoCenEnc input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                vActivo = value.value
                            }
                        })                        

                        var cenencjson = JSON.stringify({ "Id": $('#txtCenEncId').val(), "Descripcion": $('#txtCenEncDescripcion').val().toString(), "Activo": vActivo });
                        var url = obtenerURL('/UserMant/ActualizarCenEnc?cenencjson=' + cenencjson);
                        $.post(url)
                            .done(function (data) {
                                var listado = JSON.parse(data);
                                if (listado.Resultado === "true") {
                                    $('#frCenEnc').empty();
                                    $('#frCenEnc').load(obtenerURL("/UserMant/ListaCenEnc"));
                                    alertify.alert().destroy();
                                    alertify.alert('Confirmación', listado.Mensaje);
                                    alertify.alert().setting('modal', true);
                                }
                                else {
                                    alertify.alert().destroy();
                                    alertify.alert('Advertencia', listado.Mensaje);
                                    alertify.alert().setting('modal', true);
                                }
                            })
                        closealertify();
                    }
                    else {
                        alertify.confirm().destroy();
                        alertify.confirm('Llenar todos los campos obligatorios!').set('basic', true);
                        alertify.confirm().setting('modal', true);
                    }
                }

                function AgregarCenEnc() {
                    var bandera = true;

                    if ($('#txtCenEncDescripcion').val().toString().length < 1) {
                        $("#lblcenencdescripcionr").show();
                        bandera = false;
                    }
                    if (bandera == true) {
                        showalertify();
                        $("#lblcenencdescripcionr").hide();

                        var listaCheck = $("#ActivoCenEnc input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                vActivo = value.value
                            }
                        })

                        var cenencjson = JSON.stringify({ "Descripcion": $('#txtCenEncDescripcion').val().toString(), "Activo": vActivo });
                        var url = obtenerURL('/UserMant/AgregarCenEnc?cenencjson=' + cenencjson);
                        $.post(url)
                            .done(function (data) {
                                var listado = JSON.parse(data);
                                if (listado.Resultado === "true") {
                                    $('#frCenEnc').empty();
                                    $('#frCenEnc').load(obtenerURL("/UserMant/ListaCenEnc"));
                                   alertify.alert().destroy();
                                   alertify.alert('Confirmación', listado.Mensaje);
                                   alertify.alert().setting('modal', true);
                               }
                               else {
                                   alertify.alert().destroy();
                                   alertify.alert('Advertencia', listado.Mensaje);
                                   alertify.alert().setting('modal', true);
                               }
                           })
                        closealertify();
                    }
                    else {
                        alertify.confirm().destroy();
                        alertify.confirm('Llenar todos los campos obligatorios!').set('basic', true);
                        alertify.confirm().setting('modal', true);
                    }
                }

                function NuevaRol() {
                    $('#txtCenEncId').prop("disabled", false);
                    $('#txtCenEncId').val("");
                    $('#txtCenEncDescripcion').val("");
                    $('#ActivoCenEnc input[type=checkbox]').prop("checked", false);
                    $('#activocenenc').prop('checked', true);
                    $('#btnActualizarCenEnc').hide();
                    $('#btnGuardaCenEnc').show();
                }

                $(document).ready(function () {
                    $('#ActivoCenEnc input[type=checkbox]').click(function () {
                        $('#ActivoCenEnc input[type=checkbox]').prop("checked", false);
                        $(this).prop("checked", true);
                    });
                })
</script>
, true);
}

