@model  PJN.DAL.Model.GENERAL.Usuario

<div class="container">
    <div class="card">
        <div class="card-body">
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Usuario" id="labelIdentificativo">
                            @Html.TextBoxFor(model => model.UsuarioId, new { id = "txtUsuarioId", PlaceHolder = "Usuario", @class = "form-control", autocomplete = "off" })
                            <span>Usuario</span>
                        </label>
                        @Html.ValidationMessage("usuarioid", "* Campo Requerido *", new { id = "lblusuarioid", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Nombres" id="labelIdentificativo">
                            @Html.TextBoxFor(model => model.Nombres, new { id = "txtNombres", PlaceHolder = "Nombres", @class = "form-control" })
                            <span>Nombres</span>
                        </label>
                        @Html.ValidationMessage("nombres", "* Campo Requerido *", new { id = "lblnombres", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Apellidos" id="labelIdentificativo">
                            @Html.TextBoxFor(model => model.Apellidos, new { id = "txtApellidos", PlaceHolder = "Apellidos", @class = "form-control" })
                            <span>Apellidos</span>
                        </label>
                        @Html.ValidationMessage("apellidos", "* Campo Requerido *", new { id = "lblapellidos", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Contraseña" id="labelIdentificativo">
                            @Html.TextBoxFor(model => model.Password, new { id = "txtPassword", type = "password", PlaceHolder = "Contraseña", @class = "form-control" })
                            <span>Contraseña</span>
                        </label>
                        @Html.ValidationMessage("password", "* Campo Requerido *", new { id = "lblcontrasena", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Correo" id="labelIdentificativo">
                            @Html.TextBoxFor(model => model.Correo, new { id = "txtCorreo", PlaceHolder = "Correo", @class = "form-control" })
                            <span>Correo</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center" id="ActivoUsu">
                <label class="input-control checkbox small-check">
                    <input type="checkbox" id="activousu" value="true" checked>
                    <span class="check"></span>
                    <span class="caption">Activo</span>
                </label>
                <label class="input-control checkbox small-check">
                    <input type="checkbox" id="inactivousu" value="false">
                    <span class="check"></span>
                    <span class="caption">Inactivo</span>
                </label>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="row" style=" height: 100px; align-content: center;">
                        <div class="col-md-12 d-flex justify-content-center" id="rowButtons">
                            <button class="btn btn-primary" style="margin-right:10px;" data-tabcontinuar="data-tabcontinuar" id="btnGuardaUsuario" onclick="AgregarUsuario()">
                                <span>Guardar</span>
                                <span class="fa fa-database"></span>
                            </button>
                            <button class="btn btn-secondary" style="margin-right:10px; display:none" data-tabcontinuar="data-tabcontinuar" id="btnActualizarUsuario" onclick="ActualizarUsuario('Actualiza')">
                                <span>Actualizar</span>
                                <span class="fa fa-database"></span>
                            </button>
                            <button class="btn btn-success" style="margin-right:10px;" data-tabcontinuar="data-tabcontinuar" id="btnNuevoUsuario" onclick="NuevaUsuario()">
                                <span>Nuevo</span>
                                <span class="fa fa-plus"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>             


@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
            function ActualizarUsuario(estado) {
                var bandera = true;
                var vActivo;
                if ($('#txtUsuarioId').val().toString().length < 1) {
                    $("#lblusuarioid").show();
                    bandera = false;
                }
                if ($('#txtNombres').val().toString().length < 1) {
                    $("#lblnombres").show();
                    bandera = false;
                }
                if ($('#txtApellidos').val().toString().length < 1) {
                    $("#lblapellidos").show();
                    bandera = false;
                }
                if ($('#txtPassword').val().toString().length < 1) {
                    $("#lblcontrasena").show();
                    bandera = false;
                }

                if (bandera == true) {
                    $("#lblusuarioid").hide();
                    $("#lblnombres").hide();
                    $("#lblapellidos").hide();
                    $("#lblcontrasena").hide();

                    var sPass = Base64.encode($('#txtPassword').val());
                    var listaCheck = $("#ActivoUsu input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                vActivo = value.value
                            }
                        })

                    var request;
                    var usuariojson = JSON.stringify({ "UsuarioId": $('#txtUsuarioId').val(), "Nombres": $('#txtNombres').val(), "Apellidos": $('#txtApellidos').val(), "Password": sPass, "Correo": $('#txtCorreo').val(), "Activo": vActivo });
                   
                    var data = new FormData();
                    data.append("usuariojson", usuariojson);

                    request = $.ajax({
                        url: '@Url.Action("ActualizarUsuario", "UserMant")',
                        type: "POST",
                        processData: false,
                        contentType: false,
                        data: data
                    });
                    request.done(function (response, textStatus, jqXHR) {
                        var listado = JSON.parse(response);
                        if (listado.Resultado === "true") {
                            $('#frUsuario').empty();
                            $('#frUsuario').load(obtenerURL("/UserMant/ListaUsuario"))
                            alertify.alert().destroy();
                            alertify.alert('Confirmación', listado.Mensaje);
                            alertify.alert().setting('modal', true);
                        }
                        else {
                            alertify.alert().destroy();
                            alertify.alert('Advertencia', listado.Mensaje);
                            alertify.alert().setting('modal', true);
                        }
                    })
                    closealertify();
                }
                else {
                    alertify.confirm().destroy();
                    alertify.confirm('Llenar todos los campos obligatorios!').set('basic', true);
                    alertify.confirm().setting('modal', true);
                }
            }

            function AgregarUsuario() {
                var bandera = true;
                var vActivo;
                if ($('#txtUsuarioId').val().toString().length < 1) {
                    $("#lblusuarioid").show();
                    bandera = false;
                }
                if ($('#txtNombres').val().toString().length < 1) {
                    $("#lblnombres").show();
                    bandera = false;
                }
                if ($('#txtApellidos').val().toString().length < 1) {
                    $("#lblapellidos").show();
                    bandera = false;
                }
                if ($('#txtPassword').val().toString().length < 1) {
                    $("#lblcontrasena").show();
                    bandera = false;
                }

                if (bandera == true) {
                    showalertify();
                    $("#lblusuarioid").hide();
                    $("#lblnombres").hide();
                    $("#lblapellidos").hide();
                    $("#lblcontrasena").hide();

                    var sPass = Base64.encode($('#txtPassword').val());
                    var listaCheck = $("#ActivoUsu input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                vActivo = value.value
                            }
                        })

                    var request;
                    var usuariojson = JSON.stringify({ "UsuarioId": $('#txtUsuarioId').val().toString(), "Nombres": $('#txtNombres').val(), "Apellidos": $('#txtApellidos').val(), "Password": sPass, "Correo": $('#txtCorreo').val(), "Activo": vActivo });
                    var data = new FormData();
                    data.append("usuariojson", usuariojson);
                    request = $.ajax({
                        url: '@Url.Action("AgregarUsuario","UserMant")',
                        type: "POST",
                        processData: false,
                        contentType: false,
                        data: data
                    });
                    request.done(function (response, textStatus, jqXHR){
                        var listado = JSON.parse(response);
                        if (listado.Resultado === "true") {
                            vusuarioId = $('#txtUsuarioId').val().toString();
                            $('#frUsuario').empty();
                            $('#frUsuario').load(obtenerURL("/UserMant/ListaUsuario"));
                            alertify.alert().destroy();
                            alertify.alert('Confirmación', listado.Mensaje);
                            alertify.alert().setting('modal', true);
                            //moverTab();
                        }
                        else {
                            alertify.alert().destroy();
                            alertify.alert('Advertencia', listado.Mensaje);
                            alertify.alert().setting('modal', true);
                        }
                    })
                    closealertify();
                }
                else {
                    alertify.confirm().destroy();
                    alertify.confirm('Llenar todos los campos obligatorios!').set('basic', true);
                    alertify.confirm().setting('modal', true);
                }
            }

            //function moverTab() {
            //    $("#usurolentidad").show()
            //    var idFrame = "#frRelRoles";
            //    var tabs = $(idFrame).parent().parent().children('.tabs');
            //    var frames = $(idFrame).parent().children('.frame');
            //    tabs.children('li').removeClass('active');
            //    frames.css({ display: "none" });
            //    var newTab = tabs.children('li:has(a[href="' + idFrame + '"])');
            //    newTab.addClass('active');
            //    $(idFrame).css({ display: "block" });
            //    relUsuRoles();
            //};

            function NuevaUsuario() {
                $('#txtUsuarioId').prop("disabled", false);
                $('#txtUsuarioId').val("");
                $('#txtNombres').val("");
                $('#txtApellidos').val("");
                $('#txtPassword').val("");
                $('#txtCorreo').val("");
                $('#ActivoUsu input[type=checkbox]').prop("checked", false);
                $('#activousu').prop('checked', true);
                $('#btnActualizarUsuario').hide();
                //$('#btnActualizarPassword').hide();
                $('#btnGuardaUsuario').show();
            }

            $(document).ready(function () {
                $('#ActivoUsu input[type=checkbox]').click(function () {
                    $('#ActivoUsu input[type=checkbox]').prop("checked", false);
                    $(this).prop("checked", true);
                });
            })
        </script>
    , true);
}


