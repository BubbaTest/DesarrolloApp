@model  PJN.DAL.Model.GENERAL.SeccionFormulario

@Html.Hidden("txtrelGUID")
<div class="container">
    <div class="card">
        <div class="card-body">
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="SeccionId">
                            @Html.TextBoxFor(model => model.SeccionId, new { id = "txtSeccionId", PlaceHolder = "SeccionId", @class = "form-control", autocomplete = "off" })
                            <span>SeccionId</span>
                        </label>
                        @Html.ValidationMessage("seccionid", "* Campo Requerido *", new { id = "lblseccionid", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Descripcion">
                            @Html.TextBoxFor(model => model.Descripcion, new { id = "txtSDescripcion", PlaceHolder = "Descripcion", @class = "form-control" })
                            <span>Descripción</span>
                        </label>
                        @Html.ValidationMessage("sdescripcion", "* Campo Requerido *", new { id = "lblsdescripcion", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="has-float-label" data-toggle="tooltip" data-placement="top" title="Censo/Encuesta">
                            @Html.DropDownListFor(model => model.CenEnc, new SelectList(ViewBag.CenEnc as System.Collections.IEnumerable, "Id", "Descripcion"),
                                "", new { id = "ddlSCenEnc", @class = "form-control sel", @style = "width:100%;" })
                            <span>Censo/Encuesta:</span>
                        </label>
                        @Html.ValidationMessage("scenenc", "* Campo Requerido *", new { id = "lblscenenc", @style = "color:red; display: none;" })
                    </div>
                </div>
            </div>
            <div class="row justify-content-center" id="ActivoSec">
                <label class="input-control checkbox small-check">
                    <input type="checkbox" id="activosec" value="true" checked>
                    <span class="check"></span>
                    <span class="caption">Activo</span>
                </label>
                <label class="input-control checkbox small-check">
                    <input type="checkbox" id="inactivosec" value="false">
                    <span class="check"></span>
                    <span class="caption">Inactivo</span>
                </label>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="row" style=" height: 100px; align-content: center;">
                        <div class="col-md-12 d-flex justify-content-center" id="rowButtons">
                            <button class="btn btn-primary" style="margin-right:10px;" data-tabcontinuar="data-tabcontinuar" id="btnGuardaSeccion" onclick="AgregarSeccion()">
                                <span>Guardar</span>
                                <span class="fa fa-database"></span>
                            </button>
                            <button class="btn btn-secondary" style="margin-right:10px; display:none" data-tabcontinuar="data-tabcontinuar" id="btnActualizaSeccion" onclick="ActualizarSeccion('Actualiza')">
                                <span>Actualizar</span>
                                <span class="fa fa-database"></span>
                            </button>
                            <button class="btn btn-success" style="margin-right:10px;" data-tabcontinuar="data-tabcontinuar" id="btnNuevoSeccion" onclick="NuevaSeccion()">
                                <span>Nuevo</span>
                                <span class="fa fa-plus"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
@<script type="text/javascript">
     function ActualizarSeccion(estado) {
         var vActivo;
         var bandera = true;
         if ($('#txtSeccionId').val().toString().length < 1) {
             $("#lblseccionid").show();
             bandera = false;
         }
         if ($('#txtSDescripcion').val().toString().length < 1) {
             $("#lblsdescripcion").show();
             bandera = false;
         }

         if ($('#ddlSCenEnc').val() == "" || $('#ddlSCenEnc').val() == null) {
             $("#lblscenenc").show();
             bandera = false;
         }

         if (bandera == true) {
             $("#lblseccionid").hide();
             $("#lblsdescripcion").hide();
             $("#lblscenenc").hide();

             var listaCheck = $("#ActivoSec input[type='checkbox']");
             $.each(listaCheck, function (index, value) {
                 if ($(value).prop('checked') === true) {
                     vActivo = value.value
                 }
             })
             var seccionjson = JSON.stringify({ "SeccionId": $('#txtSeccionId').val(), "Descripcion": $('#txtSDescripcion').val(), "Activo": vActivo, "CenEnc": $('#ddlSCenEnc').val(), relGUID: $("#txtrelGUID").val() });
             var url = obtenerURL('/UserMant/ActualizarSeccion?seccionjson=' + seccionjson);
             $.post(url)
                 .done(function (data) {
                     var listado = JSON.parse(data);
                     if (listado.Resultado === "true") {
                         $('#frSeccion').empty();
                         $('#frSeccion').load(obtenerURL("/UserMant/ListaSeccion"));
                         alertify.alert().destroy();
                         alertify.alert('Confirmación', listado.Mensaje);
                         alertify.alert().setting('modal', true);
                     }
                     else {
                         alertify.alert().destroy();
                         alertify.alert('Advertencia', listado.Mensaje);
                         alertify.alert().setting('modal', true);
                     }
                 })
             closealertify();
         }
         else {
             alertify.confirm().destroy();
             alertify.confirm('Llenar todos los campos obligatorios!').set('basic', true);
             alertify.confirm().setting('modal', true);
         }
     }

     function AgregarSeccion() {
         var vActivo;
         var bandera = true;
         if ($('#txtSeccionId').val().toString().length < 1) {
             $("#lblseccionid").show();
             bandera = false;
         }
         if ($('#txtSDescripcion').val().toString().length < 1) {
             $("#lblsdescripcion").show();
             bandera = false;
         }

         if ($('#ddlSCenEnc').val() == "" || $('#ddlSCenEnc').val() == null) {
             $("#lblscenenc").show();
             bandera = false;
         }

         if (bandera == true) {
             $("#lblseccionid").hide();
             $("#lblsdescripcion").hide();
             $("#lblscenenc").hide();

             var listaCheck = $("#ActivoSec input[type='checkbox']");
             $.each(listaCheck, function (index, value) {
                 if ($(value).prop('checked') === true) {
                     vActivo = value.value
                 }
             })
             var seccionjson = JSON.stringify({ "SeccionId": $('#txtSeccionId').val(), "Descripcion": $('#txtSDescripcion').val(), "Activo": vActivo, "CenEnc": $('#ddlSCenEnc').val() });
             var url = obtenerURL('/UserMant/AgregarSeccion?seccionjson=' + seccionjson);
             $.post(url)
                 .done(function (data) {
                     var listado = JSON.parse(data);
                     if (listado.Resultado === "true") {
                         $('#frSeccion').empty();
                         $('#frSeccion').load(obtenerURL("/UserMant/ListaSeccion"));
                         alertify.alert().destroy();
                         alertify.alert('Confirmación', listado.Mensaje);
                         alertify.alert().setting('modal', true);
                     }
                     else {
                         alertify.alert().destroy();
                         alertify.alert('Advertencia', listado.Mensaje);
                         alertify.alert().setting('modal', true);
                     }
                 })
             closealertify();
         }
         else {
             alertify.confirm().destroy();
             alertify.confirm('Llenar todos los campos obligatorios!').set('basic', true);
             alertify.confirm().setting('modal', true);
         }
     }

    function NuevaSeccion() {
        $("#txtrelGUID").val("");
         $('#txtSeccionId').prop("disabled", false);
         $('#txtSeccionId').val("");
         $('#txtSDescripcion').val("");
         $('#ddlSCenEnc').select2("val", "ca");
         $('#ActivoSec input[type=checkbox]').prop("checked", false);
         $('#activosec').prop('checked', true);
         $('#btnActualizarSeccion').hide();
         $('#btnGuardaSeccion').show();
     }

     $(document).ready(function () {
         $('#ActivoSec input[type=checkbox]').click(function () {
             $('#ActivoSec input[type=checkbox]').prop("checked", false);
             $(this).prop("checked", true);
         });

         $(".sel").select2({
             placeholder: "Seleccione Opción",
             allowClear: true,
         });
     })

</script>
, true);
}



